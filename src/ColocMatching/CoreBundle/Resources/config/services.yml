services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    ColocMatching\CoreBundle\:
        resource: '%kernel.project_dir%/src/ColocMatching/CoreBundle/*'
        exclude: '%kernel.project_dir%/src/ColocMatching/CoreBundle/{DTO,DataFixtures,Entity,Event,Exception,Repository,Tests}'


    # ----------- Commands ----------
    ColocMatching\CoreBundle\Command\CreateAdminCommand:
        tags:
            - { name: "console.command", command: "app:create-admin" }


    # ----------- Listeners ----------
    ColocMatching\CoreBundle\Listener\UpdateListener:
        tags:
            - { name: 'doctrine.orm.entity_listener', event: prePersist }
            - { name: 'doctrine.orm.entity_listener', event: preUpdate }

    ColocMatching\CoreBundle\Listener\InvitationListener:
        tags:
            - { name: 'doctrine.orm.entity_listener', event: postPersist }

    ColocMatching\CoreBundle\Listener\PictureListener:
        arguments:
            $directoryPath: '%upload_directory%'
        tags:
            - { name: 'doctrine.orm.entity_listener', event: prePersist }
            - { name: 'doctrine.orm.entity_listener', event: preUpdate }
            - { name: 'doctrine.orm.entity_listener', event: postPersist }
            - { name: 'doctrine.orm.entity_listener', event: postUpdate }
            - { name: 'doctrine.orm.entity_listener', event: postRemove }

    ColocMatching\CoreBundle\Listener\DeleteAnnouncementEventSubscriber:
        tags:
            - { name: 'kernel.event_subscriber', event: 'coloc_matching.announcement.deleted' }

    ColocMatching\CoreBundle\Listener\UserListener:
        tags:
            - { name: 'doctrine.orm.entity_listener', event: prePersist }
            - { name: 'doctrine.orm.entity_listener', event: preUpdate }

    ColocMatching\CoreBundle\Listener\CacheDriverListener:
        arguments:
            $cacheProvider: '@coloc_matching.doctrine_cache.apcu'
            $lifeTime: 3600
        tags:
            - { name: 'doctrine.orm.entity_listener', event: postPersist }
            - { name: 'doctrine.orm.entity_listener', event: postUpdate }
            - { name: 'doctrine.orm.entity_listener', event: postRemove }


    # ----------- FormTypes ----------
    ColocMatching\CoreBundle\Form\Type\BooleanType:
        tags:
            - { name: 'form.type', alias: 'boolean' }

    ColocMatching\CoreBundle\Form\Type\AddressType:
        tags:
            - { name: 'form.type', alias: 'address' }

    ColocMatching\CoreBundle\Form\DataTransformer\AddressTypeToAddressTransformer:
        arguments:
            $region: '%geocoder.region%'
            $apiKey: '%geocoder.google.api_key%'


    # ----------- Others -----------
    ColocMatching\CoreBundle\Service\MailerService:
        arguments:
            $mailSender: '@ColocMatching\MailBundle\Service\HtmlMailSender'
            $from: '%mailer_no_reply%'
