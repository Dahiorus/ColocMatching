imports:
    - { resource: "@CoreBundle/Resources/config/listeners.yml" }
    - { resource: "@CoreBundle/Resources/config/managers.yml" }
    - { resource: "@CoreBundle/Resources/config/mappers.yml" }
    - { resource: "@CoreBundle/Resources/config/commands.yml" }

services:
    # ----------  Security  ----------
    coloc_matching.core.user_provider:
        class: ColocMatching\CoreBundle\Security\User\UserProvider
        arguments:
            - "@coloc_matching.core.user_dto_manager"
            - "@coloc_matching.core.user_dto_mapper"

    coloc_matching.core.jwt_user_extractor:
        class: ColocMatching\CoreBundle\Security\User\JwtUserExtractor
        arguments:
            - "@request_stack"
            - "@coloc_matching.core.jwt_token_encoder"

    coloc_matching.core.jwt_token_encoder:
        class: ColocMatching\CoreBundle\Security\User\JwtEncoder
        arguments:
            - "@logger"
            - "@coloc_matching.core.user_dto_manager"
            - "@coloc_matching.core.user_dto_mapper"
            - "@lexik_jwt_authentication.jwt_manager"
            - "@lexik_jwt_authentication.extractor.authorization_header_extractor"

        
    # ----------- Validator -----------
    coloc_matching.core.form_validator:
        class: ColocMatching\CoreBundle\Validator\FormValidator
        arguments: ["@logger", "@form.factory"]

    coloc_matching.core.user_password_validator:
        class: ColocMatching\CoreBundle\Validator\Constraint\UserPasswordValidator
        arguments: ["@security.password_encoder"]
        tags:
            - { name: "validator.constraint_validator" }

    coloc_matching.core.unique_value_validator:
        class: ColocMatching\CoreBundle\Validator\Constraint\UniqueValueValidator
        arguments: ["@doctrine.orm.entity_manager"]
        tags:
            - { name: "validator.constraint_validator" }


    # ----------- FormTypes ----------
    coloc_matching.form.type.boolean:
        class: ColocMatching\CoreBundle\Form\Type\BooleanType
        tags:
            - { name: "form.type", alias: "boolean" }
            
    coloc_matching.form.type.address:
        class: ColocMatching\CoreBundle\Form\Type\AddressType
        arguments: ["@coloc_matching.form.type.address_type_to_address_transformer"]
        tags:
            - { name: "form.type", alias: "address" }

    coloc_matching.form.type.address_type_to_address_transformer:
        class: ColocMatching\CoreBundle\Form\DataTransformer\AddressTypeToAddressTransformer
        arguments:
            - "%geocoder.region%"
            - "%geocoder.google.api_key%"
            

    # ----------- Others -----------
    coloc_matching.core.filter_factory:
        class: ColocMatching\CoreBundle\Repository\Filter\FilterFactory
        arguments: ["@form.factory"]


    coloc_matching.core.event_dispatcher_visitor:
        class: ColocMatching\CoreBundle\Service\EventDispatcherVisitor
        arguments:
            - "@event_dispatcher"
            - "@coloc_matching.core.jwt_user_extractor"
            - "@logger"
